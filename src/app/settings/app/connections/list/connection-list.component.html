@if (data().org; as org) {
    <div class="connections-card">
        <h4>Connected datasources</h4>
        <ul class="connections-list">
            @if (org.datasource_id) {
                <app-connection-item
                    icon="images/icons/external-reports/005-google-analytics.png"
                    [title]="'Google Analytics 4'"
                    [properties]="getDatasourceProperties(org.datasource!)"
                    [authStep]="org.datasource?.auth_step ?? ''"
                    authStepCondition="step4"
                    setupLink="/settings/app/connections/new"
                    (disconnectClick)="onDisconnectClick(org.datasource_id)"
                ></app-connection-item>
                @if (org.datasource?.unique_id) {
                    <app-tracker-code-snippet
                        [identifier]="org.datasource?.unique_id"
                    ></app-tracker-code-snippet>
                }
            }
            @if (org.big_query_datasource_id) {
                <app-connection-item
                    icon="images/icons/external-reports/google-bigquery-logo.svg"
                    [title]="'Google Big Query'"
                    [properties]="getBQDatasourceProperties(org.big_query_datasource!)"
                    [authStep]="org.big_query_datasource?.auth_step ?? ''"
                    authStepCondition="step3"
                    setupLink="/settings/app/connections/new-bq"
                    (disconnectClick)="onBQDisconnectClick(org.big_query_datasource_id)"
                ></app-connection-item>
            }
        </ul>

        @if (shouldShowNewConnection()) {
            @if (hasNoDatasource()) {
                <p>No datasources yet</p>
                <br />
            }
            <a [matMenuTriggerFor]="menu" mat-button class="p-0 h-auto text-d">+ New connection</a>
            <mat-menu #menu="matMenu">
                @if (canAddGoogleAnalytics()) {
                    <button mat-menu-item routerLink="/settings/app/connections/new">
                        <div class="d-flex g-5 align-items-center">
                            <div class="icon">
                                <img src="images/icons/external-reports/005-google-analytics.png" />
                            </div>
                            <span>Google Analytics</span>
                        </div>
                    </button>
                }
                @if (canAddBigQuery()) {
                    <button mat-menu-item routerLink="/settings/app/connections/new-bq">
                        <div class="d-flex g-5 align-items-center">
                            <div class="icon d-flex align-items-center">
                                <img src="images/icons/external-reports/google-bigquery-logo.svg" />
                            </div>
                            <span>Google Big Query</span>
                        </div>
                    </button>
                }
            </mat-menu>
        }
    </div>
}
