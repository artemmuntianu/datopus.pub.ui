<div class="alert alert-bg-d text-md d-flex justify-content-between align-items-center" *ngIf="isAlertVisible.reportExplanation">
    Use this report to dive deeper into the data and compare segments using drill-down.
    <button type="button" class="close bg-transparent text-white p-0 border-none" (click)="isAlertVisible.reportExplanation = false">
        <i class="ri-close-line"></i>
    </button>
</div>

<mat-drawer-container hasBackdrop="false">
    <mat-drawer-content data-ds-feature="Report.Usage.Main">
        <div style="text-align: right; height: 50px;">
            <button mat-fab class="daxa"
                    style="margin-bottom: 10px; box-shadow: none; height: 30px; width: 30px"
                    (click)="onBtnClick_ShowHideSettingsPane()"
                    [style.display]="drawer.opened ? 'none' : 'inline-flex'">
                <mat-icon>settings</mat-icon>
            </button>
        </div>
        <mat-card class="daxa-card mb-25 border-radius bg-white border-none d-block">
            <mat-card-content>
                <app-reports-features-usage-lineChart />
            </mat-card-content>
        </mat-card>
        <mat-card class="daxa-card mb-25 border-radius bg-white border-none d-block">
            <mat-card-content>
                <div class="features-usage-table">
                    <div class="table-responsive">
                        <table *ngIf="data" mat-table matSort matSortActive="date" matSortDirection="asc" matSortDisableClear="true" [dataSource]="dataSource">

                            <ng-container matColumnDef="date">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
                                <td mat-cell *matCellDef="let x">{{x.date|date}}</td>
                            </ng-container>
                            <ng-container matColumnDef="partner_org">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Organization</th>
                                <td mat-cell *matCellDef="let x">{{x.partner_org}}</td>
                            </ng-container>
                            <ng-container matColumnDef="feature">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Feature</th>
                                <td mat-cell *matCellDef="let x">{{x.feature}}</td>
                            </ng-container>
                            <ng-container *ngFor="let dim of data.dims | keyvalue" [matColumnDef]="dim.value.col_name">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>{{dim.value.ui_name}}</th>
                                <td mat-cell *matCellDef="let x">{{x[dim.value.col_name]}}</td>
                            </ng-container>
                            <ng-container matColumnDef="actions">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Actions</th>
                                <td mat-cell *matCellDef="let x">{{x.actions | number}}</td>
                            </ng-container>
                            <ng-container matColumnDef="sessions">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Sessions</th>
                                <td mat-cell *matCellDef="let x">{{x.sessions | number}}</td>
                            </ng-container>
                            <ng-container matColumnDef="users">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Users</th>
                                <td mat-cell *matCellDef="let x">{{x.users | number}}</td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

                        </table>
                    </div>
                    <mat-paginator [pageSizeOptions]="[10, 20, 30]" showFirstLastButtons></mat-paginator>
                </div>
            </mat-card-content>
        </mat-card>
    </mat-drawer-content>
    <mat-drawer data-ds-feature="Report.Usage.Filters" #drawer mode="side" opened="true" position="end">
        <ng-scrollbar>
            <div *ngIf="data">
                <span class="lh-30"></span>
                <button mat-fab class="daxa"
                        style="margin-bottom: 10px; box-shadow: none; height: 30px; width: 30px; float: right"
                        (click)="onBtnClick_ShowHideSettingsPane()"
                        [style.display]="drawer.opened ? 'inline-flex' : 'none'">
                    <mat-icon>close</mat-icon>
                </button>
                <div class="clear-both">
                    <mat-divider class="mb-10"></mat-divider>
                    <div class="mat-mdc-subheader mb-10">Filter</div>
                    <ng-date-range-picker class="d-block mb-10" [selectedDates]="selectedDateRange" (onDateSelectionChanged)="onDateRangeChanged($event)" (dateListOptions)="dateListOptions($event)"></ng-date-range-picker>
                    <mat-form-field *ngIf="user.orgType == 'b2b'" class="mb-10">
                        <mat-label>Organizations</mat-label>
                        <mat-select multiple (selectionChange)="onFilterChanged()" [(ngModel)]="selectedPartnerOrgs">
                            <mat-option *ngFor="let x of data.partnerOrgs" [value]="x.name">{{ x.name }}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field class="mb-10">
                        <mat-label>Features</mat-label>
                        <mat-select multiple (selectionChange)="onFilterChanged()" [(ngModel)]="selectedFeatures">
                            <mat-option *ngFor="let x of data.feature.values" [value]="x">{{ x }}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field *ngFor="let dim of data.dims | keyvalue" class="mb-10">
                        <mat-label>{{dim.value.ui_name}}</mat-label>
                        <mat-select multiple (selectionChange)="onFilterChanged()" [(ngModel)]="selectedDims[dim.value.col_name]">
                            <mat-option *ngFor="let x of dim.value.values" [value]="x">{{ x }}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-divider class="mb-10"></mat-divider>
                    <div class="mat-mdc-subheader mb-10">Chart</div>
                    <mat-form-field class="mb-10">
                        <mat-label>Drilldown Dimension</mat-label>
                        <mat-select (selectionChange)="onFilterChanged()" [(ngModel)]="selectedChartDimension">
                            <mat-option>--None--</mat-option>
                            <mat-option *ngIf="user.orgType == 'b2b'" value="partner_org">Organizations</mat-option>
                            <mat-option value="feature">Features</mat-option>
                            <mat-option *ngFor="let dim of data.dims | keyvalue" [value]="dim.value.col_name">{{dim.value.ui_name}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field class="mb-10">
                        <mat-label>Metric</mat-label>
                        <mat-select (selectionChange)="onChartMetricChanged()" [(ngModel)]="selectedChartMetric">
                            <mat-option value="actions">Actions, sum</mat-option>
                            <mat-option value="sessions">Sessions, sum</mat-option>
                            <mat-option value="users">Users, sum</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div class="alert alert-bg-warning" *ngIf="isAlertVisible.filtersRequired">
                        When Sessions or Users selected, it is required to set filter/drilldown for all of the following dimensions: Features, Actions, Product Categories.
                    </div>
                </div>
            </div>
        </ng-scrollbar>
    </mat-drawer>

</mat-drawer-container>